# 4 嵌入式Web应用的利用

在本章，将包含以下内容：
* 开始Web安全测试
* 使用Burp Suite
* 使用OWASP ZAP
* 利用命令注入
* 利用XSS
* 利用CSRF

## 4.1 简介 （Introduction)

Web应用和Web服务用来执行远程访问特性，也用来管理设备。物联网设备的Web应用被赋予了一股巨大的力量，这个力量可以被黑客利用使其可以远程执行设备控制。像包括车联网或者有远程执行漏洞的智能门锁，这样的产品会对设备用户产生伤害和个人安全威胁。当测试之前提到的IoT种类的产品时，定位对用户风险高和影响大的漏洞是我们的第一目标。本章，我们将展示如何选择一个Web测试方法，建立Web测试工具箱，也会讨论如何发现和利用最常见的嵌入式Web应用漏洞。


## 4.2 开始web应用安全测试
现代的web是一直运行着的应用，其是运行在成千上万个web，应用，和数据库服务器作为后端系统的应用。Web应用已经从静态HTML页面发展到需要更多计算资源的复杂应用。虽然Web应用改变了，但是一些最常见的安全问题没有变化。在90年代首次发现的漏洞仍然是相关的并且还能在被利用。在IoT产品中，常见的漏洞常常是命令注入（command injection)、跨站脚本攻击（XSS）、目录遍历、绕过认证、session劫持、XML外部实体攻击（XXE）、跨站请求伪造（CSRF)和其他业务逻辑缺陷。本节，我们将建立web应用测试方法，用于找到和利用IoT Web应用和web服务漏洞。
### 4.2.1 How to do it...
为了开始评估web应用，一旦你掌握了一个东西，建立一个方法论，甚至是一个检查表是很重要的。理解你的方法和带有上下文的应用风险是成功损坏安全控制的关键。在我们建立了与我们目标应用相关的方法后，我们将开始配置web测试环境和工具箱，来开始我们的web安全测试。
#### 4.2.1.1 web渗透测试方法
除了web渗透测试方法，还有很多渗透测试方法。没有本身是对的或者错的方法；然而，建立你的方法来测试应用对你成功发现人家缺陷是重要的。最常用的方法是渗透测试执行标准（PTES) 和OWASP的web应用渗透测试方法。开放web应用安全项目（OWASP)是一个提供工具和文档的非盈利型的公益慈善组织，而且在国际上倡导软件安全。如果你曾经测试过应用或者修复软件漏洞，你可能已经熟悉了OWASP。如果你曾经进行过渗透测试，你可能也已经使用了PTES。PTES旨在为渗透测试提供可遵循的基线。PTES定义渗透测试由以下七个阶段组成：
* 前期交互阶段
* 智能情报收集
* 威胁建模阶段
* 漏洞分析阶段
* 渗透利用阶段
* 后渗透利用阶段
* 生成报告阶段

虽然PTES与信息安全测试所以的孤岛相关，但是其实最常用应用于面向网络的渗透测试中。其中有很多部分属于web安全，但是此时还不足够进行一个成功的评估。PTES确实为每个阶段的方法提供了详细的手把手的实例，而且也包含了工具使用示例。另一方面，OWASP的Web应用渗透测试方法是纯粹为web应用渗透测试而生的。OWASPweb渗透测试方法包含以下132类：
* 简介和目标
* 情报收集
* 配置和部署管理测试
* 身份管理测试
* 认证测试
* 授权测试
* session管理测试
* 输入验证测试
* 错误处理
* 加密
* 业务逻辑测试
* 客户端测试

与PTES类似，OWASP的测试方法每阶段提供了一些带有截图和工具参考和使用的示例。当在一些领域经验不足时，有与你测试的应用相关的示例是非常有用的。OWASP测试方法最好的东西是对用例的特定测试方法的上下文，例如黑盒或者灰盒。OWASP被认为实际上是为应用测试提供测试指南和测试工具的组织。当有疑问时，看一下OWASP的测试指南或者他们大量的备忘录系列助手。

#### 4.2.1.1 选择你的测试工具
有许多可用的web测试工具。为评估web应用而组装你的工具箱的第一步是选择一个浏览器并自定义配置。常用的测试浏览器是firefox。因为它有许多可用的测试插件。其他浏览器也可以使用，但是可能需要一些应用，例如这些使用ActiveX或者Silverlight的，其需要Internet Explorer浏览器才能工作。一些插件使得测试更简单并高效。常用的插件如下：
* FoxyProxy: 一个Chrome和Firefox的管理浏览器代理的工具。有事你会并行运行多个代理工具，而且可能需要在两个中切换。FoxyProxy不需要在多个浏览器设置菜单中点击就能帮助改变代理设置。FoxyProxy可以通过[https://addons.mozilla.org/en-us/firefox/addon/foxyproxy-standard/](https://addons.mozilla.org/en-us/firefox/addon/foxyproxy-standard/)下载。
* Cookie Manager+: 一个有用的编辑cookie值和浏览他们属性的cookie管理器。Chrome和Firefox上有很多可用的cookie管理器插件。Firefox的一个常用的cookie管理器是Cookie Manager+。Cookie Manager+可以通过[https://addons.mozilla.org/en-us/firefox/addon/cookies-manager-plus/](https://addons.mozilla.org/en-us/firefox/addon/cookies-manager-plus/)下载。
* Wappalyzer: 为了更好地理解目标应用，它帮忙了解什么组件被利用了。Wappalyzer是一个可以协助发现所使用的技术的插件，可能包括web服务器、框架和JS库。Wapplyzer可以通过[https://wapplyzer.com/download](https://wapplyzer.com/download)下载

浏览器选定之后，必须使用web应用代理工具设置浏览器代理，以用于查看应用请求和响应。接下来，我们将要学习配置代理设置和web应用代理工具。